import * as React from 'react'

export default class extends React.Component {
    constructor(props) {
        super(props)
        this.state = {
            preview: false,
            rotate: 0,
            scale: 1,
            activeIndex: 0,
            curIndex: props.curIndex,
            imgList: props.urlList,
            defaultIndex: props.curIndex
        }
    }

    componentWillReceiveProps(nextProps) {
        this.setState({
            imgList: nextProps.urlList
        })
    }

    cancelDefault(e) {
        e.stopPropagation()
    }

    turnLeft() { 
        this.setState({
            rotate: (this.state.rotate - 90) 
        })
    }
    
    turnRight() {
        this.setState({
            rotate: (this.state.rotate + 90)  
        })
    }

    scaleUp() {
        if (this.state.scale >= 1.5) return 
        this.setState({
            scale: this.state.scale + 0.1
        })
    }

    scaleDown() {
        if (this.state.scale <= 0.3) return 
        this.setState({
            scale: this.state.scale - 0.1
        })
    }

    prevImg() {
        if(this.state.curIndex==0) {
            this.setState({
                curIndex: this.props.urlList.length-1,
                rotate: 0,
                scale: 1
            })
        } else {
            this.setState({
                curIndex: this.state.curIndex-1,
                rotate: 0,
                scale: 1
            })
        }
    }

    nextImg() {
        if(this.state.curIndex==this.props.urlList.length-1) {
            this.setState({
                curIndex: 0,
                rotate: 0,
                scale: 1
            })
        } else {
            this.setState({
                curIndex: this.state.curIndex+1,
                rotate: 0,
                scale: 1
            })
        }
    }

    changePreview(){
        this.setState({
            preview: !this.state.preview,
            rotate: 0,
            scale: 1
        })
    }

    render() {
        const { preview, rotate, scale, curIndex } = this.state
        const { concise, download, turning, url, urlList, defaultIndex, imgwidth, imgheight } = this.props
        return (
        <div onClick={() => {this.changePreview()}}>
            {
                defaultIndex? <img src={urlList[defaultIndex]} width={imgwidth} height={imgheight}/> : <img src={url} width={imgwidth} height={imgheight}/>
            }
            {preview && (
                <div className="preview-wrapper" onClick={(event) => {this.cancelDefault(event)}}>
                    {turning ? 
                        <img id="content" className="preview-img" src={urlList[curIndex]} style={{transform: `rotate(${rotate}deg) scale(${scale})`}} /> : <img id="content" className="preview-img" src={url} style={{transform: `rotate(${rotate}deg) scale(${scale})`}} />
                    }
                    
                    <div className="close tool"onClick={() => {this.changePreview()}}>
                        {CloseSvg}
                    </div>
                    {!concise && <div className="tool-bar">
                        <div className="tool icon" onClick={() => {this.turnLeft()}}>
                            {TurnLeft}
                        </div>
                        <div className="tool icon" onClick={() => {this.turnRight()}}>
                            {TurnRight}
                        </div>
                        <div className={`tool icon ${scale >= 1.5 ? 'disabled' : ''}`} onClick={() => {this.scaleUp()}}>
                            {ScaleUp}
                        </div>
                        <div className={`tool icon ${scale <=0.3 ? 'disabled' : ''}`} onClick={() => {this.scaleDown()}}>
                            {ScaleDown}
                        </div>
                        {turning && 
                            <>
                                <div className="tool icon" onClick={() => {this.prevImg()}}>
                                    {PrevImg}
                                </div>
                                <div className="tool icon" onClick={() => {this.nextImg()}}>
                                    {NextImg}
                                </div>
                            </>
                        }
                        {download && <div className="tool icon">
                            <a href={url} download={url}>{Download}</a>
                        </div>}
                    </div>}
                </div>
            )}
        </div>
        )
    }
}

const CloseSvg = <svg t="1575361937812" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5238" width="40" height="40"><path d="M507.168 473.232L716.48 263.936a16 16 0 0 1 22.624 0l11.312 11.312a16 16 0 0 1 0 22.624L541.12 507.168 750.4 716.48a16 16 0 0 1 0 22.624l-11.312 11.312a16 16 0 0 1-22.624 0L507.168 541.12 297.872 750.4a16 16 0 0 1-22.624 0l-11.312-11.312a16 16 0 0 1 0-22.624l209.296-209.312-209.296-209.296a16 16 0 0 1 0-22.624l11.312-11.312a16 16 0 0 1 22.624 0l209.296 209.296z" p-id="5239" fill="#ffffff"></path></svg>

const TurnLeft = <svg t="1575514481390" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4773" width="32" height="32"><path d="M356.905842 700.29405l61.331341-120.226802c8.003333-15.449344 13.114358-26.87348 15.332115-34.271447 2.215835-7.400849 3.326635-14.774793 3.326634-22.12087 0-19.443804-7.16639-36.651595-21.499168-51.612803-14.33374-14.963129-32.262205-22.443733-53.785397-22.443733-20.552682 0-38.103514 7.212513-52.650574 21.637538-14.548981 14.425025-21.822031 32.065221-21.822031 52.915783 0 21.503012 7.096244 39.495858 21.292575 53.974694 14.19441 14.476914 31.424301 21.718254 51.688714 21.718253l-41.817392 81.263283 38.603183 19.166104z m-16.467898-152.653321c-5.897041-6.150719-8.842199-13.81005-8.842199-22.981837 0-9.279408 3.026834-17.019454 9.086267-23.224944 6.05655-6.204529 13.304616-9.307274 21.741315-9.307274 8.003333 0 15.008292 3.130611 21.011993 9.387989 6.00274 6.257378 9.004591 14.027213 9.00459 23.30566 0 9.065127-2.867325 16.669687-8.599091 22.820406-5.734649 6.149758-12.81744 9.224637-21.2551 9.224636-8.871025-0.000961-16.253617-3.074879-22.147775-9.224636zM501.634624 687.802355c12.221683 8.327156 27.309729 12.491695 45.267021 12.491695 17.955371 0 32.828175-4.136673 44.618414-12.410979s21.175345-21.228195 28.153399-38.859743c6.976131-17.628665 10.463236-42.291115 10.463236-73.985429 0-31.368569-3.434255-55.8398-10.301805-73.419459-6.870432-17.575815-16.605307-30.637324-29.206545-39.183565-12.600277-8.542398-27.61049-12.816479-45.022952-12.81648-26.828318 0-47.757673 10.816847-62.791909 32.450542-13.522741 19.686912-20.280748 51.432153-20.280748 95.240529 0 31.371452 3.4602 55.546726 10.384442 72.527744 6.920399 16.979097 16.492881 29.636067 28.717447 37.965145z m11.02248-162.250787c3.127728-12.006441 7.660292-20.470045 13.598651-25.393695 5.936438-4.920767 12.735764-7.381631 20.403743-7.381631 11.22523 0 20.370112 5.94893 27.442333 17.84775 7.067417 11.89882 10.603528 33.531554 10.603528 64.901083 0 30.934242-3.937767 53.001302-11.818105 66.197338-6.478385 10.92639-15.22065 16.388143-26.227756 16.388143-11.444315 0-20.75351-5.759632-27.93143-17.280819-7.17792-11.517343-10.764959-32.368865-10.764959-62.54688 0-23.146151 1.563384-40.724849 4.693995-52.731289zM745.634909 545.101071c10.939842-10.760154 16.412166-23.985016 16.412166-39.669781 0-15.575222-5.446379-28.771257-16.333372-39.589065-10.883149-10.815886-24.020569-16.22479-39.398807-16.224791-15.385925 0-28.626161 5.408904-39.731279 16.224791-11.103195 10.816847-16.654313 23.849529-16.654312 39.101889 0 15.900967 5.416591 29.261316 16.250735 40.078163 10.832222 10.815886 24.046514 16.22479 39.646719 16.224791 15.596362 0 28.865425-5.381038 39.80815-16.145997z m-76.395365-39.750497c0-10.404621 3.629318-19.26796 10.89468-26.584249 7.26344-7.317251 16.04222-10.977318 26.342103-10.977318 10.079837 0 18.645297 3.632201 25.692535 10.895642 7.045316 7.26344 10.567974 16.260344 10.567974 26.989749 0 10.297961-3.577429 19.107489-10.731327 26.422818-7.15582 7.317251-15.719357 10.976357-25.690613 10.976357-10.083681 0-18.784627-3.739821-26.101878-11.218504-7.315329-7.477721-10.973474-16.313193-10.973474-26.504495z" fill="#ffffff" p-id="4774"></path><path d="M940.913739 348.403953c-24.493332-57.9115-59.553677-109.913466-104.20284-154.565512-44.652045-44.650124-96.654973-79.709508-154.565512-104.203801-59.971668-25.365829-123.659136-38.228431-189.296269-38.228431-65.636172 0-129.323639 12.862603-189.296268 38.228431-57.910539 24.494293-109.914427 59.553677-154.564551 104.203801a492.319814 492.319814 0 0 0-24.457779 26.343064L90.690518 89.276225c-4.13379-15.98937-20.446023-25.60221-36.436354-21.467459-15.991292 4.132829-25.601249 20.446023-21.46842 36.436353l51.94143 200.93949c4.13379 15.990331 20.446023 25.601249 36.437315 21.467459a30.635402 30.635402 0 0 0 2.70205-0.839826l198.223026-51.239974c15.98937-4.13379 25.601249-20.446983 21.467459-36.438275-4.131868-15.990331-20.446023-25.601249-36.435393-21.467459l-130.447892 33.71989c78.241253-86.02454 191.004748-140.117425 316.175379-140.117425 235.685621 0 427.430262 191.744641 427.430262 427.430262 0 235.687542-191.744641 427.430262-427.430262 427.430262-234.229858 0-425.055879-189.387554-427.401434-423.072582 0.408382-1.966962 0.625546-4.003108 0.625546-6.090182 0-16.431384-13.319991-29.750414-29.750414-29.750414-16.324724 0-29.570726 13.148951-29.742727 29.431395h-0.007687c-0.002883 0.685121-0.016335 1.368321-0.016335 2.051521 0 65.637133 12.861642 129.3246 38.226509 189.296269 24.496215 57.9115 59.55656 109.916349 104.206684 154.565512 44.648202 44.650124 96.654012 79.709508 154.564551 104.204761 59.972629 25.365829 123.660097 38.22747 189.296268 38.227471 65.637133 0 129.326522-12.861642 189.296269-38.227471 57.9115-24.495254 109.914427-59.555599 154.565512-104.204761 44.650124-44.650124 79.709508-96.654973 104.20284-154.565512 25.365829-59.971668 38.22747-123.659136 38.22747-189.296269 0.000961-65.635211-12.862603-129.322678-38.228431-189.295308z" fill="#ffffff" p-id="4775"></path></svg>

const TurnRight = <svg t="1575514449911" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3900" width="32" height="32"><path d="M371.993 679.438l63.07-123.636c8.23-15.889 13.486-27.637 15.767-35.245 2.279-7.61 3.421-15.192 3.421-22.747 0-19.995-7.37-37.691-22.108-53.078-14.74-15.386-33.176-23.079-55.311-23.079-21.136 0-39.184 7.416-54.144 22.251-14.961 14.833-22.441 32.974-22.441 54.417 0 22.112 7.297 40.615 21.896 55.503 14.597 14.889 32.314 22.333 53.155 22.333l-43.003 83.569 39.698 19.712z m-16.936-156.983c-6.064-6.325-9.093-14.2-9.093-23.634 0-9.542 3.113-17.501 9.344-23.881 6.228-6.38 13.682-9.571 22.358-9.571 8.23 0 15.433 3.219 21.607 9.652 6.173 6.436 9.26 14.426 9.26 23.968 0 9.321-2.949 17.141-8.843 23.466-5.897 6.325-13.182 9.486-21.858 9.486-9.122 0-16.713-3.161-22.775-9.486z m257.285-87.621c-12.959-8.785-28.393-13.18-46.301-13.18-27.588 0-49.111 11.123-64.571 33.37-13.906 20.245-20.856 52.891-20.856 97.94 0 32.261 3.558 57.121 10.678 74.584 7.118 17.463 16.962 30.478 29.533 39.043 12.567 8.563 28.086 12.847 46.552 12.847 18.463 0 33.758-4.254 45.884-12.763 12.123-8.511 21.774-21.83 28.95-39.962 7.173-18.129 10.76-43.49 10.76-76.085 0-32.256-3.531-57.423-10.595-75.5-7.065-18.073-17.076-31.505-30.034-40.294z m-18.244 184.372c-6.661 11.235-15.652 16.851-26.971 16.851-11.77 0-21.342-5.922-28.724-17.77-7.384-11.846-11.071-33.286-11.071-64.321 0-23.801 1.607-41.878 4.828-54.225 3.217-12.347 7.877-21.05 13.983-26.113 6.105-5.061 13.098-7.591 20.983-7.591 11.542 0 20.948 6.117 28.22 18.354 7.269 12.236 10.905 34.482 10.905 66.741 0.001 31.811-4.05 54.503-12.153 68.074z m96.353-180.867c-11.418 11.123-17.125 24.526-17.125 40.21 0 16.352 5.569 30.09 16.71 41.213 11.14 11.123 24.729 16.686 40.771 16.686 16.039 0 29.685-5.534 40.937-16.604 11.251-11.065 16.878-24.666 16.878-40.794 0-16.018-5.601-29.589-16.796-40.711-11.193-11.123-24.701-16.685-40.517-16.685-15.823 0-29.437 5.562-40.858 16.685z m67.445 13.207c7.246 7.469 10.869 16.721 10.869 27.754 0 10.589-3.68 19.648-11.037 27.173-7.358 7.524-16.164 11.286-26.419 11.286-10.37 0-19.317-3.846-26.842-11.536-7.522-7.69-11.285-16.776-11.285-27.257 0-10.699 3.734-19.814 11.203-27.337 7.47-7.524 16.498-11.289 27.089-11.289 10.368 0.001 19.175 3.737 26.422 11.206z" p-id="3901" fill="#ffffff"></path><path d="M951.34 512.234c0 242.367-197.182 439.549-439.549 439.549-242.369 0-439.549-197.182-439.549-439.551 0-242.367 197.18-439.549 439.549-439.549 135.338 0 256.57 61.495 337.265 157.996l-136.951-35.401c-16.443-4.25-33.22 5.633-37.469 22.078-4.252 16.443 5.633 33.22 22.076 37.47l203.843 52.692c0.905 0.326 1.828 0.618 2.778 0.864 16.444 4.25 33.22-5.633 37.472-22.076L994.218 79.67c4.251-16.445-5.633-33.22-22.075-37.47-16.445-4.252-33.22 5.633-37.471 22.076L900.287 197.29a505.782 505.782 0 0 0-34.884-38.667c-45.918-45.917-99.396-81.971-158.949-107.159-61.672-26.086-127.166-39.312-194.664-39.312S378.799 25.377 317.127 51.463c-59.554 25.188-113.032 61.241-158.949 107.159-45.915 45.918-81.969 99.394-107.158 158.947-26.084 61.674-39.314 127.166-39.314 194.663 0 67.498 13.226 132.993 39.31 194.665 25.191 59.554 61.245 113.031 107.16 158.947 45.918 45.918 99.396 81.971 158.95 107.16 61.67 26.084 127.166 39.311 194.663 39.311s132.992-13.227 194.664-39.311c59.554-25.189 113.031-61.242 158.947-107.16 45.917-45.917 81.971-99.394 107.16-158.947 26.085-61.672 39.311-127.166 39.311-194.663H951.34z" p-id="3902" fill="#ffffff"></path></svg>

const ScaleUp = <svg t="1575514405634" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3026" width="32" height="32"><path d="M946.2 921.5L797.8 773c71.8-76.6 114.9-177.2 114.9-287.3 0-229.9-186.8-421.4-421.4-421.4C256.6 64.2 69.8 251 69.8 485.7s186.8 421.4 421.4 421.4c105.4 0 201.1-38.3 273-100.6L912.7 955c4.8 4.8 9.6 4.8 19.2 4.8s14.4 0 19.2-4.8c4.7-9.6 4.7-24-4.9-33.5z m-454.9-62.3c-205.9 0-373.5-167.6-373.5-373.5s167.6-373.5 373.5-373.5 373.5 167.6 373.5 373.5-172.4 373.5-373.5 373.5z m0 0" p-id="3027" fill="#ffffff"></path><path d="M654.1 461.7H515.2V322.8c0-14.4-14.4-23.9-23.9-23.9-9.6 0-23.9 9.6-23.9 23.9v138.9h-139c-14.4 0-23.9 9.6-23.9 23.9 0 14.4 9.6 23.9 23.9 23.9h138.9v138.9c0 14.4 9.6 23.9 23.9 23.9 14.4 0 23.9-9.6 23.9-23.9V509.6H654c14.4 0 23.9-9.6 23.9-23.9 0.1-14.4-14.2-24-23.8-24z m0 0" p-id="3028" fill="#ffffff"></path></svg>

const ScaleDown = <svg t="1575514364907" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1977" width="32" height="32"><path d="M928 960c-8 0-16-3.2-22.4-9.6L700.8 747.2c-12.8-12.8-12.8-32 0-44.8s32-12.8 44.8 0l203.2 203.2c12.8 12.8 12.8 32 0 44.8-4.8 6.4-12.8 9.6-20.8 9.6z m-464-96C243.2 864 64 684.8 64 464S243.2 64 464 64s400 179.2 400 400c0 59.2-12.8 115.2-36.8 168-8 16-27.2 22.4-43.2 16-16-8-22.4-27.2-16-43.2 22.4-44.8 32-91.2 32-140.8 0-185.6-150.4-336-336-336S128 278.4 128 464s150.4 336 336 336c89.6 0 174.4-35.2 236.8-99.2 12.8-12.8 32-12.8 44.8 0s12.8 32 0 44.8C672 822.4 571.2 864 464 864z m144-368H320c-17.6 0-32-14.4-32-32s14.4-32 32-32h288c17.6 0 32 14.4 32 32s-14.4 32-32 32z" p-id="1978" fill="#ffffff"></path></svg>

const Download = <svg t="1575512210984" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7402" width="200" height="200"><path d="M512 109.6c-222.2 0-402.3 180.1-402.3 402.4 0 222.2 180.1 402.4 402.3 402.4 222.2 0 402.4-180.1 402.4-402.4 0-222.2-180.2-402.4-402.4-402.4z m0 764.5C312 874.1 149.9 712 149.9 512S312 149.9 512 149.9c200 0 362.1 162.1 362.1 362.1S712 874.1 512 874.1z m142.3-390.5L532.1 605.7V310.8h-40.2v294.9L369.7 483.6 341.3 512l142.3 142.3 28.4 28.4 28.4-28.4L682.7 512l-28.4-28.4z" fill="#ffffff" p-id="7403"></path></svg>

const PrevImg = <svg t="1575514552868" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5632" width="32" height="32"><path d="M646.4 771.072 689.92 727.296 489.216 526.848 689.92 326.144 646.4 282.368 402.176 526.848Z" p-id="5633" fill="#ffffff"></path></svg>

const NextImg = <svg t="1575514580136" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6493" width="32" height="32"><path d="M445.696 771.072l-43.52-43.776L602.88 526.848 402.176 326.144l43.52-43.776 244.224 244.48z" p-id="6494" fill="#ffffff"></path></svg>